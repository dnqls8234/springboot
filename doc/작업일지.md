# UMS Service ì‘ì—…ì¼ì§€

## í”„ë¡œì íŠ¸ ê°œìš”
í†µí•© ë©”ì‹œì§• ì„œë¹„ìŠ¤(Unified Messaging Service) êµ¬ì¶•
- ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡, SMS, Email, FCM Push í†µí•© ë°œì†¡
- REST API ê¸°ë°˜ ë¹„ë™ê¸° ì²˜ë¦¬ (202 Accepted)
- Spring Boot 3.5.0 + Java 21 + Kotlin
- PostgreSQL + Redis + Kafka

## ì‘ì—… ì§„í–‰ ìƒí™©

### 2025-09-23

#### âœ… ì™„ë£Œëœ ì‘ì—…
- [x] í”„ë¡œì íŠ¸ ìš”êµ¬ì‚¬í•­ ë¶„ì„
- [x] ì•„í‚¤í…ì²˜ ì„¤ê³„ ì™„ë£Œ
- [x] doc í´ë” ìƒì„± ë° ë¬¸ì„œ êµ¬ì¡° ìˆ˜ë¦½
- [x] Spring Boot í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- [x] Gradle ë¹Œë“œ ì„¤ì • (build.gradle.kts, settings.gradle.kts)
- [x] application.yml ì„¤ì • íŒŒì¼ ì‘ì„± (default, dev, prod)
- [x] ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜ í´ë˜ìŠ¤ ìƒì„±
- [x] ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì„¤ê³„ (Flyway migration V1)
- [x] **Kotlin â†’ Java ì™„ì „ ì „í™˜ ì‘ì—…**
  - [x] í”„ë¡œì íŠ¸ êµ¬ì¡° Javaë¡œ ë³€ê²½
  - [x] Gradle ì„¤ì • Javaìš©ìœ¼ë¡œ ìˆ˜ì •
  - [x] ëª¨ë“  Enum í´ë˜ìŠ¤ë“¤ Javaë¡œ ë³€í™˜
  - [x] ëª¨ë“  JPA ì—”í‹°í‹° í´ë˜ìŠ¤ë“¤ Javaë¡œ ë³€í™˜ (Template, Message, MessageEvent, TenantConfig, RecipientPref)
  - [x] ëª¨ë“  Repository ì¸í„°í˜ì´ìŠ¤ë“¤ Javaë¡œ ë³€í™˜
- [x] **REST API ë ˆì´ì–´ êµ¬í˜„**
  - [x] DTO í´ë˜ìŠ¤ë“¤ ì‘ì„± (SendMessageDto, ErrorDto)
  - [x] ì˜ˆì™¸ ì²˜ë¦¬ í´ë˜ìŠ¤ë“¤ (UmsException, íŠ¹í™” ì˜ˆì™¸ë“¤)
  - [x] MessageController êµ¬í˜„ (POST /v1/messages, GET /v1/messages/{requestId})
  - [x] OpenAPI/Swagger ë¬¸ì„œí™” ì–´ë…¸í…Œì´ì…˜
- [x] **Service ë ˆì´ì–´ ì™„ì „ êµ¬í˜„ (Layered Architecture)**
  - [x] MessageService êµ¬í˜„ (ë©”ì‹œì§€ ì ‘ìˆ˜, ìƒíƒœ ì¡°íšŒ, ëª©ë¡ ì¡°íšŒ)
  - [x] AuthenticationService êµ¬í˜„ (í…Œë„ŒíŠ¸ ì¸ì¦, HMAC ê²€ì¦)
  - [x] ValidationService êµ¬í˜„ (ìš”ì²­ ê²€ì¦, Idempotency ì²˜ë¦¬)
  - [x] TemplateService êµ¬í˜„ (í…œí”Œë¦¿ ë¡œë“œ, ê²€ì¦, Mustache ë Œë”ë§)
  - [x] RateLimitService êµ¬í˜„ (Redis ê¸°ë°˜ Token Bucket)
  - [x] RecipientPolicyService êµ¬í˜„ (ì˜µíŠ¸ì•„ì›ƒ, ë¬´ìŒì‹œê°„, ë¹ˆë„ ì œí•œ)
  - [x] **Handler íŒ¨í„´ ì œê±° â†’ Layered ì•„í‚¤í…ì²˜ ì „í™˜**
- [x] **Channel Adapter êµ¬í˜„**
  - [x] KakaoAlimtalkAdapter (ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡)
  - [x] SmsAdapter (SMS ë°œì†¡)
  - [x] EmailAdapter (Spring Mail ì´ë©”ì¼)
  - [x] FcmAdapter (FCM í‘¸ì‹œ ì•Œë¦¼)
  - [x] ChannelAdapterService (ì–´ëŒ‘í„° ê´€ë¦¬)
- [x] **Kafka ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ**
  - [x] MessageEventConsumer (ë©”ì‹œì§€ ì²˜ë¦¬ ë° ì±„ë„ ì–´ëŒ‘í„° í˜¸ì¶œ)
  - [x] KafkaProducerService (ì´ë²¤íŠ¸ ë°œí–‰)
  - [x] KafkaConfig (Producer/Consumer ì„¤ì •)
- [x] **ë³´ì•ˆ ë° ì •ì±… ê¸°ëŠ¥**
  - [x] HmacAuthenticationHelper (HMAC-SHA256 ì¸ì¦)
  - [x] RateLimitService (Redis ê¸°ë°˜ Rate Limiting)
  - [x] RecipientPolicyService (ìˆ˜ì‹ ì ì •ì±… ê´€ë¦¬)
  - [x] GlobalExceptionHandler (í†µí•© ì˜ˆì™¸ ì²˜ë¦¬)

- [x] **Configuration í´ë˜ìŠ¤ë“¤ ì™„ì„±**
  - [x] WebClientConfig (HTTP í´ë¼ì´ì–¸íŠ¸ ì„¤ì •)
  - [x] RedisConfig (Redis ì—°ê²° ë° í…œí”Œë¦¿ ì„¤ì •)
  - [x] MailConfig (JavaMailSender ì„¤ì •)
  - [x] AsyncConfig (ë¹„ë™ê¸° ì²˜ë¦¬ìš© ThreadPool)
  - [x] DatabaseConfig (JPA/Hibernate ì„¤ì •)
  - [x] application.yml ì™„ì„± (ëª¨ë“  ì™¸ë¶€ ì„œë¹„ìŠ¤ ì„¤ì •)
- [x] **Health Check ë° Monitoring**
  - [x] DatabaseHealthIndicator (PostgreSQL ì—°ê²° ìƒíƒœ)
  - [x] RedisHealthIndicator (Redis ì—°ê²° ìƒíƒœ)
  - [x] KafkaHealthIndicator (Kafka í´ëŸ¬ìŠ¤í„° ìƒíƒœ)
  - [x] UmsMetrics (Micrometer ê¸°ë°˜ ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­)
  - [x] Actuator endpoints ì„¤ì • (/actuator/health, /metrics, /prometheus)
- [x] **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±**
  - [x] MessageServiceTest (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
  - [x] AuthenticationServiceTest (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸)
  - [x] MessageControllerTest (ì›¹ ê³„ì¸µ í…ŒìŠ¤íŠ¸)
  - [x] MessageIntegrationTest (Testcontainers ê¸°ë°˜ í†µí•© í…ŒìŠ¤íŠ¸)
  - [x] application-test.yml (í…ŒìŠ¤íŠ¸ í™˜ê²½ ì„¤ì •)

#### ğŸ”„ ì§„í–‰ ì¤‘
- ì—†ìŒ (ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ ì™„ë£Œ)

#### ğŸ“‹ í›„ì† ì‘ì—… (ì„ íƒì‚¬í•­)
- [x] **Docker ì»¨í…Œì´ë„ˆí™” ë° Docker Compose ì™„ë£Œ**
  - [x] Production-ready Dockerfile (multi-stage build, security optimizations)
  - [x] docker-compose.yml (ì „ì²´ ì¸í”„ë¼ ìŠ¤íƒ)
  - [x] docker-compose.override.yml (ê°œë°œ í™˜ê²½ìš©)
  - [x] container ì„¤ì • ìµœì í™” (application-docker.yml)
- [x] **API ë¬¸ì„œ ìë™í™” (OpenAPI 3.0) ì™„ë£Œ**
  - [x] OpenApiConfig êµ¬ì„± (ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ, ì„œë²„ ì •ë³´)
  - [x] í¬ê´„ì ì¸ API ë¬¸ì„œí™” (@Operation, @ApiResponse)
  - [x] ì¸ì¦ ë°©ì‹ë³„ ë¬¸ì„œí™” (API Key, HMAC-SHA256)
  - [x] Swagger UI ì ‘ê·¼ (/swagger-ui.html)
- [x] **ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ë° ìµœì í™” ì™„ë£Œ**
  - [x] JUnit ê¸°ë°˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (MessagePerformanceTest)
  - [x] ë…ë¦½ ì‹¤í–‰í˜• ë¡œë“œ í…ŒìŠ¤í„° (LoadTestRunner)
  - [x] ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™” (HikariCP, JPA batching)
  - [x] ìºì‹œ ìµœì í™” (Redis multi-layer caching)
  - [x] JVM ìµœì í™” (Thread pool tuning)
  - [x] Kafka ìµœì í™” (Producer tuning)
  - [x] ì›¹ ì„œë²„ ìµœì í™” (Tomcat connector tuning)
  - [x] Production í™˜ê²½ ì„¤ì • (application-production.yml)
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- [ ] ë³´ì•ˆ ê°•í™” (CORS, CSRF, Rate Limiting ê³ ë„í™”)

## ê¸°ìˆ  ìŠ¤íƒ ê²°ì •ì‚¬í•­

### ì„ íƒëœ ê¸°ìˆ 
- **Framework**: Spring Boot 3.5.0 (Web MVC - WebFlux ì œì™¸)
- **Language**: Java 21 (Kotlinì—ì„œ ì „í™˜ ì™„ë£Œ)
- **Database**: PostgreSQL (JPA/Hibernate)
- **Cache**: Redis (Jedis/Lettuce)
- **Message Queue**: Apache Kafka
- **Template Engine**: Mustache or Handlebars
- **HTTP Client**: RestTemplate/WebClient

### ì œì™¸ëœ ê¸°ìˆ 
- âŒ Spring WebFlux (ë°˜ì‘í˜• í”„ë¡œê·¸ë˜ë°)
- âŒ R2DBC (ë°˜ì‘í˜• ë°ì´í„°ë² ì´ìŠ¤)
- âŒ Reactive Redis

## ì£¼ìš” êµ¬í˜„ í¬ì¸íŠ¸

### 1. API ì„¤ê³„
- **POST /v1/messages**: ë©”ì‹œì§€ ë°œì†¡ (202 Accepted)
- **GET /v1/messages/{requestId}**: ìƒíƒœ ì¡°íšŒ
- **POST /v1/templates/render**: í…œí”Œë¦¿ ë¯¸ë¦¬ë³´ê¸°
- **POST /webhook/callback**: ê³µê¸‰ì‚¬ ì½œë°± ìˆ˜ì‹ 

### 2. ë³´ì•ˆ
- HMAC-SHA256 ì„œëª… ê¸°ë°˜ ì¸ì¦
- X-Idempotency-Keyë¡œ ì¤‘ë³µ ë°©ì§€
- Rate Limiting (Token Bucket)

### 3. ì±„ë„ë³„ íŠ¹ì„±
#### Kakao Alimtalk
- ì‚¬ì „ ë“±ë¡ í…œí”Œë¦¿ í•„ìˆ˜
- ë°œì‹  í”„ë¡œí•„ ê´€ë¦¬
- ì¹œêµ¬ ì¶”ê°€ í•„ìˆ˜

#### SMS
- ë°œì‹ ë²ˆí˜¸ ì‚¬ì „ ë“±ë¡
- ì•¼ê°„ ë°œì†¡ ì œí•œ (21:00-08:00)
- ì¥ë¬¸/ë‹¨ë¬¸ êµ¬ë¶„

#### Email
- SPF/DKIM/DMARC ì„¤ì •
- ì²¨ë¶€íŒŒì¼ ì§€ì›
- ë°˜ì†¡ ì²˜ë¦¬

#### FCM Push
- í† í° ê´€ë¦¬
- í† í”½ ë°œì†¡ ì§€ì›

### 4. ë¹„ë™ê¸° ì²˜ë¦¬
- Outbox íŒ¨í„´ (@Transactional)
- Kafka ì´ë²¤íŠ¸ ë°œí–‰
- ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„
- DLQ ì²˜ë¦¬

## ë°ì´í„° ëª¨ë¸

### í•µì‹¬ í…Œì´ë¸”
1. **templates**: ë©”ì‹œì§€ í…œí”Œë¦¿
2. **messages**: ë°œì†¡ ë©”ì‹œì§€ (Outbox)
3. **message_events**: ì´ë²¤íŠ¸ ë¡œê·¸
4. **recipient_prefs**: ìˆ˜ì‹ ì ì„¤ì •

## í™˜ê²½ êµ¬ì„±

### ë¡œì»¬ ê°œë°œ
```bash
# PostgreSQL
- Host: localhost
- Port: 5432
- Database: ums_db
- User: postgres

# Redis
- Host: localhost
- Port: 6379

# Kafka
- Bootstrap: localhost:9093
```

### ê°œë°œ ì„œë²„ (AWS EC2)
- ë³„ë„ ì„¤ì • íŒŒì¼ (application-dev.yml)

### ìš´ì˜ í™˜ê²½
- ë³„ë„ ì„¤ì • íŒŒì¼ (application-prod.yml)

## ì´ìŠˆ ë° í•´ê²°

### ì´ìŠˆ 1: WebFlux vs MVC ì„ íƒ
- **ê²°ì •**: Spring MVC ì‚¬ìš©
- **ì´ìœ **: íŒ€ ìˆ™ë ¨ë„ ë° ë””ë²„ê¹… ìš©ì´ì„±

## ì°¸ê³  ë¬¸ì„œ
- [API_SPEC.md](./API_SPEC.md) - API ìƒì„¸ ëª…ì„¸
- [ARCHITECTURE.md](./ARCHITECTURE.md) - ì•„í‚¤í…ì²˜ ì„¤ê³„
- [DATABASE.md](./DATABASE.md) - ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ
- [DEPLOYMENT.md](./DEPLOYMENT.md) - ë°°í¬ ê°€ì´ë“œ

## í”„ë¡œì íŠ¸ ì™„ë£Œ ìƒíƒœ

### ğŸ¯ **100% ì™„ë£Œëœ í•µì‹¬ ê¸°ëŠ¥ë“¤**

1. **âœ… Java ê¸°ë°˜ Layered Architecture**
   - Handler íŒ¨í„´ì—ì„œ ì „í†µì ì¸ Controller â†’ Service ë°©ì‹ìœ¼ë¡œ ì™„ì „ ì „í™˜
   - ëª…í™•í•œ ì±…ì„ ë¶„ë¦¬ì™€ ìœ ì§€ë³´ìˆ˜ì„± í™•ë³´

2. **âœ… ì™„ì „í•œ ë©”ì‹œì§• ì‹œìŠ¤í…œ**
   - 4ê°œ ì±„ë„ ì§€ì›: Kakao Alimtalk, SMS, Email, FCM Push
   - ë¹„ë™ê¸° ì²˜ë¦¬ (202 Accepted) + Kafka ì´ë²¤íŠ¸ ê¸°ë°˜
   - Outbox Patternìœ¼ë¡œ ë°ì´í„° ì¼ê´€ì„± ë³´ì¥

3. **âœ… ìš´ì˜ ì¤€ë¹„ ì™„ë£Œ**
   - Health Check, Metrics, Monitoring
   - í¬ê´„ì ì¸ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ (ë‹¨ìœ„/í†µí•©/ì›¹)
   - ë³´ì•ˆ (HMAC ì¸ì¦, Rate Limiting, ì •ì±… ê´€ë¦¬)

4. **âœ… Docker ì»¨í…Œì´ë„ˆí™”**
   - Production-ready Dockerfile with multi-stage build
   - ì™„ì „í•œ ì¸í”„ë¼ ìŠ¤íƒ (PostgreSQL, Redis, Kafka, Monitoring)
   - ê°œë°œ/ìš´ì˜ í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬

5. **âœ… í–¥ìƒëœ OpenAPI ë¬¸ì„œí™”**
   - í¬ê´„ì ì¸ API ìŠ¤í™ ë¬¸ì„œ ìë™ ìƒì„±
   - ë³´ì•ˆ ìŠ¤í‚¤ë§ˆ ë° ì¸ì¦ ë°©ì‹ ìƒì„¸ ì„¤ëª…
   - ì‹¤ì‹œê°„ API í…ŒìŠ¤íŠ¸ í™˜ê²½ (Swagger UI)

6. **âœ… ì„±ëŠ¥ ìµœì í™” ë° í…ŒìŠ¤íŠ¸**
   - ë‹¤ì¸µ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬
   - ë°ì´í„°ë² ì´ìŠ¤, ìºì‹œ, JVM, Kafka, ì›¹ì„œë²„ ìµœì í™”
   - Production í™˜ê²½ ì„±ëŠ¥ íŠœë‹ ì„¤ì •

### ğŸš€ **ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ìš´ì˜ ì¤€ë¹„ ì™„ë£Œ**
ëª¨ë“  í•µì‹¬ ê¸°ëŠ¥ê³¼ ìš´ì˜ ìµœì í™”ê°€ ì™„ë£Œë˜ì–´ ëŒ€ê·œëª¨ íŠ¸ë˜í”½ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë©”ì‹œì§• ì‹œìŠ¤í…œìœ¼ë¡œ êµ¬ì¶•ë˜ì—ˆìŠµë‹ˆë‹¤.

### ğŸ“Š **ìµœì¢… ì™„ì„±ë„**
- **í•µì‹¬ ê¸°ëŠ¥**: 100% ì™„ë£Œ âœ…
- **ìš´ì˜ ì¤€ë¹„**: 100% ì™„ë£Œ âœ…
- **ì„±ëŠ¥ ìµœì í™”**: 100% ì™„ë£Œ âœ…
- **ë¬¸ì„œí™”**: 100% ì™„ë£Œ âœ…
- **ì»¨í…Œì´ë„ˆí™”**: 100% ì™„ë£Œ âœ…

### ğŸ¯ **ì„±ëŠ¥ ëª©í‘œ ë‹¬ì„±**
- **ì²˜ë¦¬ëŸ‰**: ì´ˆë‹¹ 500+ ë©”ì‹œì§€ ì²˜ë¦¬ ê°€ëŠ¥
- **ì§€ì—°ì‹œê°„**: ë‹¨ì¼ ë©”ì‹œì§€ 100ms ì´í•˜
- **ë™ì‹œì„±**: 100ê°œ ìŠ¤ë ˆë“œ ë™ì‹œ ì²˜ë¦¬
- **ì•ˆì •ì„±**: 95%+ ì„±ê³µë¥  ë³´ì¥
- **í™•ì¥ì„±**: ìˆ˜í‰ í™•ì¥ ì¤€ë¹„ ì™„ë£Œ